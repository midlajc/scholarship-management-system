<!-- Modal -->
<div class="modal fade align-middle" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body ">
                <div class="card">
                    <div class="card-body">
                        <p>
                        <div class="fs-3">Name</div>
                        <div id="name"></div>
                        </p>
                        <p>
                        <div class="fs-3">Email
                            <span id="badge" class="badge">
                                <i class="fa" id="badgeIcon"></i>
                            </span>
                            </p>
                        </div>
                        <div id="email">

                        </div>
                        <p>
                        <div class="fs-3">Gender</div>
                        <div id="gender"></div>
                        </p>
                        <p>
                        <div class="fs-3">College</div>
                        <div id="college"></div>
                        </p>
                        <p>
                        <div class="fs-3">Time</div>
                        <div id="time"></div>
                        </p>
                        <p>
                        <div class="fs-3">Items</div>
                        <ul>
                            <div id="items"></div>
                        </ul>
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="sendVerificationEmail()" class="btn btn-primary">Send Verification
                        Email</button>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="container mt-5 text-center">
    <h3>Email Verification Pending</h3>
    <table class="table text-center table-bordered" id='myTable'>
        <thead class="">
            <tr>
                <th>Name</th>
                <th>email</th>
                <th>Phone No</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {{#each data}}
            <tr>
                <td>{{this.name}}</td>
                <td>{{this.email}}</td>
                <td>{{this.phoneno}}</td>
                <td><button type="button" onclick="getUserData('{{this.email}}')" class="btn btn-primary"
                        data-toggle="modal" data-target="#myModal">view
                        more</button></td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</section>
<script>
    function getUserData(email) {
        $('#loading').show()
        $.ajax({
            url: '/admin/viewapplication/' + email,
            method: 'get',
            success: (data) => {
                data = data.data
                $('#name').html(data.name)
                $('#email').html(data.email)
                $('#gender').html(data.gender)
                $('#college').html(data.college)
                $('#time').html(new Date(data.submissionTime))
                $('#items').html(() => {
                    let items = ''
                    for (x of data.items) {
                        items += "<li>" + x + "</li>"
                    }
                    return items
                })
                if (data.emailVerificationStatus) {
                    $('#badge').removeClass('bg-danger')
                    $('#badge').addClass('bg-success')
                    $('#badgeIcon').removeClass('fa-times')
                    $('#badgeIcon').addClass('fa-check')
                } else {
                    console.log('hello')
                    $('#badge').removeClass('bg-success')
                    $('#badge').addClass('bg-danger')
                    $('#badgeIcon').removeClass('fa-check')
                    $('#badgeIcon').addClass('fa-times')
                }
                $('#loading').hide()
            }
        })
    }
    function sendVerificationEmail() {
        let email = $('#email').html()
        $('#loading').show()
        $.ajax({
            url: '/admin/resendverificationemail',
            data: { email: email },
            method: 'post',
            success: (response) => {
                if (response.status) {
                    document.getElementById('alert').className = "alert alert-success"
                    document.getElementById('alert').innerHTML=response.message
                } else {

                }
                $('#loading').hide()
            }
        })
    }
</script>